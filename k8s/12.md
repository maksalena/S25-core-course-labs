# Kubernetes ConfigMaps Overview

ConfigMaps are used to store configuration data as key-value pairs in Kubernetes, enabling applications to separate configuration from application code.

## Upgrade Application for Persistence with a Visit Counter

### Python Volume for Visits Counter

The following curl commands show how the visit count is updated upon accessing the /visits endpoint:

```shell
curl 0.0.0.0:8080/visits
{"visits":0}                                                                                                                                                          
curl 0.0.0.0:8080/moscow-time 
"2025-02-25T13:15:10.144695+03:00"                                                                                                                                    
curl 0.0.0.0:8080/visits     
{"visits":1} 
```

## Mount a Config File Using a ConfigMap

Here, is shown how to mount a configuration file stored in a ConfigMap into a Kubernetes pod.

### Verify the ConfigMap

To check the configuration data stored in the ConfigMap, use the following kubectl command. This will retrieve the `app-python-configmap` and display its details:

```shell
kubectl get configmap app-python-configmap -o yaml
apiVersion: v1
data:
  config.json: |
    {
      "key_one": "secret_one",
      "key_two": "secret_two"
    }
  env-var: ENV_CONFIG_VAR
kind: ConfigMap
metadata:
  annotations:
    meta.helm.sh/release-name: python
    meta.helm.sh/release-namespace: default
  creationTimestamp: "2025-02-25T13:30:45Z"
  labels:
    app.kubernetes.io/managed-by: Helm
  name: app-python-configmap
  namespace: default
  resourceVersion: "113937"
  uid: 93621de2-aa0f-4389-9d29-dedebbd2abf0
```

### Retrieve the List of Pods

Next, retrieve the list of running pods to locate the pod that has the `app-python-configmap` mounted:

```shell
kubectl get po                                     
NAME                                   READY   STATUS      RESTARTS        AGE
python-app-python-854646957c-96nrx     1/1     Running     0               54s
python-app-python-854646957c-jdtcc     1/1     Running     0               54s
python-app-python-854646957c-xt5ph     1/1     Running     0               54s

```

### Check the ConfigMap Inside the Pod

Use the following kubectl command to access the config_map directory inside the pod and verify the contents of the mounted configuration file:

```shell
kubectl exec python-app-python-854646957c-96nrx -- cat config_map/config.json
{
  "key_one": "secret_one",
  "key_two": "secret_two"
}
```

## Utilize ConfigMap via Environment Variables

Inject configuration values into the pod as environment variables. This section show how to check the value of an environment variable configured via the ConfigMap.

### Run env Command Inside the Container

Use the following command to check the environment variables set inside the pod container and verify the injected value for `CONFIG_MAP_VAR`:

```shell
kubectl exec python-app-python-854646957c-96nrx -- env | grep CONFIG_MAP_VAR
CONFIG_MAP_VAR=ENV_CONFIG_VAR
```
